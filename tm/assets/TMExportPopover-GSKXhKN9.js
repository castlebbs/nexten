import{c as W,r as x,j as r,P as X,C as z,a as G,S as C,b as k,L as M,T as K,d as I,e as Q,f as A,g as N,h as P,i as O,k as Y,B as Z,J as L}from"./index-B2J2gxgW.js";/**
 * @license lucide-react v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=W("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),_=(()=>{if(typeof self>"u")return!1;if("top"in self&&self!==top)try{top.window.document._=0}catch{return!1}return"showOpenFilePicker"in self})();_?Promise.resolve().then(function(){return re}):Promise.resolve().then(function(){return ce});_?Promise.resolve().then(function(){return ae}):Promise.resolve().then(function(){return ue});const V=_?Promise.resolve().then(function(){return ie}):Promise.resolve().then(function(){return pe});async function ee(...e){return(await V).default(...e)}const te=async e=>{const n=await e.getFile();return n.handle=e,n};var se=async(e=[{}])=>{Array.isArray(e)||(e=[e]);const n=[];e.forEach((l,u)=>{n[u]={description:l.description||"Files",accept:{}},l.mimeTypes?l.mimeTypes.map(o=>{n[u].accept[o]=l.extensions||[]}):n[u].accept["*/*"]=l.extensions||[]});const i=await window.showOpenFilePicker({id:e[0].id,startIn:e[0].startIn,types:n,multiple:e[0].multiple||!1,excludeAcceptAllOption:e[0].excludeAcceptAllOption||!1}),a=await Promise.all(i.map(te));return e[0].multiple?a:a[0]},re={__proto__:null,default:se};function g(e){function n(i){if(Object(i)!==i)return Promise.reject(new TypeError(i+" is not an object."));var a=i.done;return Promise.resolve(i.value).then(function(l){return{value:l,done:a}})}return g=function(i){this.s=i,this.n=i.next},g.prototype={s:null,n:null,next:function(){return n(this.n.apply(this.s,arguments))},return:function(i){var a=this.s.return;return a===void 0?Promise.resolve({value:i,done:!0}):n(a.apply(this.s,arguments))},throw:function(i){var a=this.s.return;return a===void 0?Promise.reject(i):n(a.apply(this.s,arguments))}},new g(e)}const R=async(e,n,i=e.name,a)=>{const l=[],u=[];var o,f=!1,d=!1;try{for(var m,w=function(p){var h,y,v,j=2;for(typeof Symbol<"u"&&(y=Symbol.asyncIterator,v=Symbol.iterator);j--;){if(y&&(h=p[y])!=null)return h.call(p);if(v&&(h=p[v])!=null)return new g(h.call(p));y="@@asyncIterator",v="@@iterator"}throw new TypeError("Object is not async iterable")}(e.values());f=!(m=await w.next()).done;f=!1){const p=m.value,h=`${i}/${p.name}`;p.kind==="file"?u.push(p.getFile().then(y=>(y.directoryHandle=e,y.handle=p,Object.defineProperty(y,"webkitRelativePath",{configurable:!0,enumerable:!0,get:()=>h})))):p.kind!=="directory"||!n||a&&a(p)||l.push(R(p,n,h,a))}}catch(p){d=!0,o=p}finally{try{f&&w.return!=null&&await w.return()}finally{if(d)throw o}}return[...(await Promise.all(l)).flat(),...await Promise.all(u)]};var ne=async(e={})=>{e.recursive=e.recursive||!1,e.mode=e.mode||"read";const n=await window.showDirectoryPicker({id:e.id,startIn:e.startIn,mode:e.mode});return(await(await n.values()).next()).done?[n]:R(n,e.recursive,void 0,e.skipDirectory)},ae={__proto__:null,default:ne},le=async(e,n=[{}],i=null,a=!1,l=null)=>{Array.isArray(n)||(n=[n]),n[0].fileName=n[0].fileName||"Untitled";const u=[];let o=null;if(e instanceof Blob&&e.type?o=e.type:e.headers&&e.headers.get("content-type")&&(o=e.headers.get("content-type")),n.forEach((m,w)=>{u[w]={description:m.description||"Files",accept:{}},m.mimeTypes?(w===0&&o&&m.mimeTypes.push(o),m.mimeTypes.map(p=>{u[w].accept[p]=m.extensions||[]})):o?u[w].accept[o]=m.extensions||[]:u[w].accept["*/*"]=m.extensions||[]}),i)try{await i.getFile()}catch(m){if(i=null,a)throw m}const f=i||await window.showSaveFilePicker({suggestedName:n[0].fileName,id:n[0].id,startIn:n[0].startIn,types:u,excludeAcceptAllOption:n[0].excludeAcceptAllOption||!1});!i&&l&&l(f);const d=await f.createWritable();return"stream"in e?(await e.stream().pipeTo(d),f):"body"in e?(await e.body.pipeTo(d),f):(await d.write(await e),await d.close(),f)},ie={__proto__:null,default:le},oe=async(e=[{}])=>(Array.isArray(e)||(e=[e]),new Promise((n,i)=>{const a=document.createElement("input");a.type="file";const l=[...e.map(d=>d.mimeTypes||[]),...e.map(d=>d.extensions||[])].join();a.multiple=e[0].multiple||!1,a.accept=l||"",a.style.display="none",document.body.append(a);const u=d=>{typeof o=="function"&&o(),n(d)},o=e[0].legacySetup&&e[0].legacySetup(u,()=>o(i),a),f=()=>{window.removeEventListener("focus",f),a.remove()};a.addEventListener("click",()=>{window.addEventListener("focus",f)}),a.addEventListener("change",()=>{window.removeEventListener("focus",f),a.remove(),u(a.multiple?Array.from(a.files):a.files[0])}),"showPicker"in HTMLInputElement.prototype?a.showPicker():a.click()})),ce={__proto__:null,default:oe},de=async(e=[{}])=>(Array.isArray(e)||(e=[e]),e[0].recursive=e[0].recursive||!1,new Promise((n,i)=>{const a=document.createElement("input");a.type="file",a.webkitdirectory=!0;const l=o=>{typeof u=="function"&&u(),n(o)},u=e[0].legacySetup&&e[0].legacySetup(l,()=>u(i),a);a.addEventListener("change",()=>{let o=Array.from(a.files);e[0].recursive?e[0].recursive&&e[0].skipDirectory&&(o=o.filter(f=>f.webkitRelativePath.split("/").every(d=>!e[0].skipDirectory({name:d,kind:"directory"})))):o=o.filter(f=>f.webkitRelativePath.split("/").length===2),l(o)}),"showPicker"in HTMLInputElement.prototype?a.showPicker():a.click()})),ue={__proto__:null,default:de},fe=async(e,n={})=>{Array.isArray(n)&&(n=n[0]);const i=document.createElement("a");let a=e;"body"in e&&(a=await async function(o,f){const d=o.getReader(),m=new ReadableStream({start:h=>async function y(){return d.read().then(({done:v,value:j})=>{if(!v)return h.enqueue(j),y();h.close()})}()}),w=new Response(m),p=await w.blob();return d.releaseLock(),new Blob([p],{type:f})}(e.body,e.headers.get("content-type"))),i.download=n.fileName||"Untitled",i.href=URL.createObjectURL(await a);const l=()=>{typeof u=="function"&&u()},u=n.legacySetup&&n.legacySetup(l,()=>u(),i);return i.addEventListener("click",()=>{setTimeout(()=>URL.revokeObjectURL(i.href),3e4),l()}),i.click(),null},pe={__proto__:null,default:fe};const F="threat_models_export.json",me=async e=>{try{const n=new Blob([JSON.stringify(e,null,2)],{type:"application/json"});await ee(n,{fileName:F,extensions:[".json"]})}catch(n){throw console.error("Error downloading file:",n),n}};function ye({threatModels:e,setThreatModels:n,selectedModelId:i,setSelectedModelId:a}){const[l,u]=x.useState({}),[o,f]=x.useState(()=>e.reduce((t,s)=>({...t,[s.id]:!1}),{})),[d,m]=x.useState(!1),[w,p]=x.useState(!1),[h,y]=x.useState(!0),[v,j]=x.useState(!1),[D,b]=x.useState(!1);x.useEffect(()=>{const t=e.reduce((s,c)=>(s[c.id]=!0,s),{});u(t)},[]),x.useEffect(()=>{if(!w)return;const t={...o};Object.keys(l).forEach(s=>{l[s]&&(t[s]=d)}),f(t),p(!1)},[d,l]),x.useEffect(()=>{f(e.reduce((t,s)=>({...t,[s.id]:!1}),{}))},[e]),x.useEffect(()=>{if(!v)return;const t={...l},s={...o};Object.keys(l).forEach(c=>{t[c]=h,h||(s[c]=!1)}),u(t),f(s),j(!1)},[h]),x.useEffect(()=>{if(h||D)return;Object.values(l).every(s=>s)&&(j(!1),y(!0))},[l,h]),x.useEffect(()=>{D&&b(!1)},[l]),x.useEffect(()=>{Object.values(l).some(s=>s)||m(!1)},[l]),x.useEffect(()=>{if(d)return;const t=Object.entries(l).filter(([,c])=>c).every(([c])=>o[c]),s=Object.values(l).some(c=>c);t&&s&&(p(!1),m(!0))},[o,l,d]),x.useEffect(()=>{Object.entries(l).some(([s,c])=>c&&!o[s])&&d&&(p(!1),m(!1))},[l,o]);const E=(t,s)=>{try{const c=localStorage.getItem(t);return c?JSON.parse(c):s}catch(c){return console.error(`Error parsing JSON for key ${t}:`,c),s}},J=async()=>{const t={};e.forEach(s=>{l[s.id]&&(t[s.id]={model:s,drawingElements:E(`${s.id}-drawingelements`,[]),systemModelData:E(`${s.id}-systemModelData`,{}),threatTree:E(`${s.id}-threattree`,[])})});try{if(await me(t),L.success(`${Object.keys(t).length} models exported successfully, filename: ${F}`),d||Object.values(o).some(s=>s)){e.forEach(c=>{(d&&l[c.id]||o[c.id])&&[`${c.id}-drawingelements`,`${c.id}-systemModelData`,`${c.id}-threattree`].forEach(S=>{const T=localStorage.getItem(S);T&&(localStorage.setItem(`removed-${S}`,T),localStorage.removeItem(S))})});const s=e.filter(c=>!(d&&l[c.id]||o[c.id]));localStorage.setItem("threatModels",JSON.stringify(s)),n(s),i&&!s.some(c=>c.id===i)&&a(null)}}catch(s){console.error("Error exporting models:",s),L.error("Models were not exported. No models were deleted.")}},H=t=>{b(!0),p(!0),m(t)},U=(t,s)=>{f(c=>({...c,[t]:s})),d&&!s&&(p(!1),m(!1))},B=t=>{b(!0),j(!0),y(t)},q=(t,s)=>{u(c=>({...c,[t]:s})),h&&!s&&(j(!1),y(!1))};return r.jsx(X,{className:"w-[400px] max-h-[80vh] overflow-y-auto",align:"start",side:"bottom",children:r.jsxs("div",{className:"space-y-4",children:[r.jsx(z,{children:r.jsxs(G,{className:"flex items-center space-x-4 pt-6",children:[r.jsx($,{className:"h-8 w-8 text-muted-foreground flex-shrink-0"}),r.jsx("div",{className:"text-sm text-muted-foreground",children:"Select threat models currently in the browser's local storage to be saved as a file on your computer. One or more threat models will be bundled in within the exported file."})]})}),r.jsx(C,{className:"my-2"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx($,{className:"h-4 w-4 text-muted-foreground"}),r.jsx(k,{id:"export-all",checked:h,onCheckedChange:B}),r.jsx(M,{htmlFor:"export-all",className:"text-sm font-medium",children:"Export all threat models"})]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(K,{className:"h-4 w-4 text-muted-foreground"}),r.jsx(k,{id:"delete-all",checked:d,onCheckedChange:H,disabled:!Object.values(l).some(t=>t)}),r.jsx(M,{htmlFor:"delete-all",className:I("text-sm font-medium",!Object.values(l).some(t=>t)&&"text-muted-foreground"),children:"Select all models for deletion"})]})]}),r.jsx(C,{className:"my-4"}),r.jsxs("div",{className:"grid grid-cols-[1fr,50px,50px] gap-2 px-4 text-sm font-medium text-muted-foreground",children:[r.jsx("div",{children:"Threat Model"}),r.jsx("div",{className:"text-center",children:"Delete"}),r.jsx("div",{className:"text-center",children:"Export"})]}),r.jsx(Q,{className:I("w-full rounded-md border",e.length===0?"h-[80px]":"h-[200px]"),children:e.length===0?r.jsx("div",{className:"h-full flex items-center justify-center text-sm text-muted-foreground p-4",children:"No threat models found in browser's local storage"}):r.jsx("div",{className:"space-y-2 p-4",children:e.map(t=>r.jsxs("div",{className:"grid grid-cols-[1fr,50px,50px] gap-2 items-center py-2 border-b last:border-b-0",children:[r.jsx(A,{children:r.jsxs(N,{children:[r.jsx(P,{asChild:!0,children:r.jsxs("div",{className:"truncate",children:[r.jsx("span",{className:"font-medium",children:t.name}),t.description&&r.jsx("div",{className:"text-muted-foreground text-sm",children:t.description})]})}),r.jsx(O,{children:r.jsxs("p",{children:[t.name,t.description&&` - ${t.description}`]})})]})}),r.jsx(A,{children:r.jsxs(N,{children:[r.jsx(P,{asChild:!0,children:r.jsx("div",{className:"flex justify-center",children:r.jsx(Y,{id:`delete-${t.id}`,checked:o[t.id],onCheckedChange:s=>U(t.id,s),disabled:!l[t.id]})})}),r.jsx(O,{children:r.jsx("p",{children:"Delete this threat model from browser local storage after export"})})]})}),r.jsx(A,{children:r.jsxs(N,{children:[r.jsx(P,{asChild:!0,children:r.jsx("div",{className:"flex justify-center",children:r.jsx(k,{id:`export-${t.id}`,checked:l[t.id],onCheckedChange:s=>{q(t.id,s),s||f(c=>({...c,[t.id]:!1}))}})})}),r.jsx(O,{children:r.jsx("p",{children:"Select this threat model to be exported in file"})})]})})]},t.id))})}),r.jsx(Z,{onClick:J,className:"w-full",disabled:!Object.values(l).some(t=>t),children:"Export Selected Models"})]})})}export{ye as default};
